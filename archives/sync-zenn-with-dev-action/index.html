<!doctype html><html lang=ja dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>📔 Zenn の記事を DEV に自動的に同期させる GitHub Actions 作ってみた | Nikaeraintokyo.</title><meta name=keywords content="typescript,githubactions,forem"><meta name=description content="はじめに
去年 DEV のアカウントを作成したものの、今まで全く有効活用出来ていませんでした。
DEV には カノニカル URL を設定出来るので、常々 Zenn の記事を投稿する際にクロスポストしたいなと考えておりました。そこで、Zenn に記事を投稿したら、自動的に DEV にも記事を投稿 & 同期する GitHub Actions を作ってみました。

            
                        
                            GitHub - nikaera/sync-zenn-with-dev-action: Just sync Zenn articles to DEV.
                        
                    
                        Just sync Zenn articles to DEV. Contribute to nikaera/sync-zenn-with-dev-action development by creating an account on GitHub.
                    "><meta name=author content="Me"><link rel=canonical href=https://zenn.dev/nikaera/articles/sync-zenn-with-dev-action><meta name=google-site-verification content="G-39TEECMFQW"><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://nikaera.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://nikaera.com/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://nikaera.com/favicon.ico><link rel=apple-touch-icon href=https://nikaera.com/apple-touch-icon.png><link rel=mask-icon href=https://nikaera.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ja href=https://nikaera.com/archives/sync-zenn-with-dev-action/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=speculationrules>
  {
    "prerender": [{ "where": { "href_matches": "/*" }, "eagerness": "moderate" }],
    "prefetch": [{ "where": { "href_matches": "/*" }, "eagerness": "moderate" }]
  }
</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-39TEECMFQW"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-39TEECMFQW")</script><meta property="og:url" content="https://nikaera.com/archives/sync-zenn-with-dev-action/"><meta property="og:site_name" content="Nikaeraintokyo."><meta property="og:title" content="📔 Zenn の記事を DEV に自動的に同期させる GitHub Actions 作ってみた"><meta property="og:description" content="はじめに 去年 DEV のアカウントを作成したものの、今まで全く有効活用出来ていませんでした。
DEV には カノニカル URL を設定出来るので、常々 Zenn の記事を投稿する際にクロスポストしたいなと考えておりました。そこで、Zenn に記事を投稿したら、自動的に DEV にも記事を投稿 & 同期する GitHub Actions を作ってみました。
GitHub - nikaera/sync-zenn-with-dev-action: Just sync Zenn articles to DEV. Just sync Zenn articles to DEV. Contribute to nikaera/sync-zenn-with-dev-action development by creating an account on GitHub. "><meta property="og:locale" content="ja"><meta property="og:type" content="article"><meta property="article:section" content="archives"><meta property="article:published_time" content="2021-03-21T00:00:00+00:00"><meta property="article:modified_time" content="2021-03-21T00:00:00+00:00"><meta property="article:tag" content="Typescript"><meta property="article:tag" content="Githubactions"><meta property="article:tag" content="Forem"><meta property="og:image" content="https://nikaera.com/cover_image.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://nikaera.com/cover_image.jpg"><meta name=twitter:title content="📔 Zenn の記事を DEV に自動的に同期させる GitHub Actions 作ってみた"><meta name=twitter:description content="はじめに
去年 DEV のアカウントを作成したものの、今まで全く有効活用出来ていませんでした。
DEV には カノニカル URL を設定出来るので、常々 Zenn の記事を投稿する際にクロスポストしたいなと考えておりました。そこで、Zenn に記事を投稿したら、自動的に DEV にも記事を投稿 & 同期する GitHub Actions を作ってみました。

            
                        
                            GitHub - nikaera/sync-zenn-with-dev-action: Just sync Zenn articles to DEV.
                        
                    
                        Just sync Zenn articles to DEV. Contribute to nikaera/sync-zenn-with-dev-action development by creating an account on GitHub.
                    "><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Archives","item":"https://nikaera.com/archives/"},{"@type":"ListItem","position":2,"name":"📔 Zenn の記事を DEV に自動的に同期させる GitHub Actions 作ってみた","item":"https://nikaera.com/archives/sync-zenn-with-dev-action/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"📔 Zenn の記事を DEV に自動的に同期させる GitHub Actions 作ってみた","name":"📔 Zenn の記事を DEV に自動的に同期させる GitHub Actions 作ってみた","description":"はじめに 去年 DEV のアカウントを作成したものの、今まで全く有効活用出来ていませんでした。\nDEV には カノニカル URL を設定出来るので、常々 Zenn の記事を投稿する際にクロスポストしたいなと考えておりました。そこで、Zenn に記事を投稿したら、自動的に DEV にも記事を投稿 \u0026amp; 同期する GitHub Actions を作ってみました。\nGitHub - nikaera/sync-zenn-with-dev-action: Just sync Zenn articles to DEV. Just sync Zenn articles to DEV. Contribute to nikaera/sync-zenn-with-dev-action development by creating an account on GitHub. ","keywords":["typescript","githubactions","forem"],"articleBody":"はじめに 去年 DEV のアカウントを作成したものの、今まで全く有効活用出来ていませんでした。\nDEV には カノニカル URL を設定出来るので、常々 Zenn の記事を投稿する際にクロスポストしたいなと考えておりました。そこで、Zenn に記事を投稿したら、自動的に DEV にも記事を投稿 \u0026 同期する GitHub Actions を作ってみました。\nGitHub - nikaera/sync-zenn-with-dev-action: Just sync Zenn articles to DEV. Just sync Zenn articles to DEV. Contribute to nikaera/sync-zenn-with-dev-action development by creating an account on GitHub. github.com 今回初めて GitHub Actions を自作したのですが、その中で得た知見を残す形で記事を書くことにしました。また、GitHub Actions は TypeScript で作成しました。\n開発した GitHub Actions の概要 まずはザッとどのような GitHub Actions を作成したのか、概要について説明いたします。\nGitHub リポジトリで管理している Zenn の記事を DEV に同期して投稿する GitHub Actions を作成しました。 その際に DEV へ投稿する記事には Zenn の該当記事へのカノニカル URL も自動で設定できます。これにより DEV と Zenn へ記事をシームレスにクロスポストすることが可能となります。\n今回作成した GitHub Actions を利用するワークフローファイルの一例は下記となります。\n# .github/workflows/sync-zenn-with-dev-all.yml name: \"Sync all Zenn articles to DEV\" on: push: branches: - main jobs: build: runs-on: ubuntu-latest steps: - name: checkout my project uses: actions/checkout@v2 - name: dev.to action step uses: nikaera/sync-zenn-with-dev-action@v1 # id を設定することで、後のジョブで Output で指定した値が参照可能になる id: dev-to with: # DEV の API キーを指定する api_key: ${{ secrets.api_key }} # (オプション) DEV に記事を投稿した際に Zenn のカノニカル URL を設定したい場合に指定する # username: nikaera # (オプション) 改行区切りで指定した articles フォルダ内のファイルパスを記載した txt ファイルを指定することで、記載された記事のみを同期するようになる。 # 他プラグインと組み合わせることで差分のみを txt ファイルに載せることが可能。詳細については後述の Outputs の項目に記載。 # added_modified_filepath: ./added_modified.txt # (オプション) Zenn の articles 以下全ての記事を常に DEV に同期するか指定する # update_all が true のときは added_modified_filepath は無視される。 # update_all: false # 上記アクション実行時に DEV に新規で同期する記事に関しては Zenn のマークダウンヘッダに # 該当する DEV の記事の ID が dev_article_id として記載されるようになる。 # 今後はその ID を元に同期するようになるため、該当する Zenn の記事をコミットする。 # 新規で同期する記事が無ければ、このジョブは実行しない。 - name: write article id of DEV to articles of Zenn. run: | git config user.name github-actions git config user.email github-actions@github.com git add ${{ steps.dev-to.outputs.newly-sync-articles }} git commit -m \"sync: Zenn with DEV [skip ci]\" git push if: steps.dev-to.outputs.newly-sync-articles # Outputs には DEV の記事情報 (title, url) が含まれるようになるため、 # 最後に出力して実行結果の内容を確認することもできる - name: Get the output articles. # dev-to という id が紐付いたジョブの Outputs を取得して echo で内容を出力する run: echo \"${{ steps.dev-to.outputs.articles }}\" 簡単に nikaera/sync-zenn-with-dev-action@v1 というジョブの内部処理について説明いたします。\nInputs の update_all 及び added_modified_filepath で受け取った情報を元に、 どの記事を DEV に同期させるか判定する DEV に同期する記事のファイルパス一覧を取得して、 それぞれの記事のヘッダに dev_article_id の記載があるか判定する Inputs の api_key を利用して、Zenn の記事に dev_article_id が含まれていれば、 該当する DEV の記事を更新する。含まれていなければ DEV に新規で記事を作成する Inputs の username を利用して、 DEV の記事に該当する Zenn 記事のカノニカル URL を設定する DEV に新規で記事を作成した場合は、 Zenn の該当記事のヘッダに dev_article_id を書き込む DEV に記事を投稿する際、Zenn は対応しているが、 DEV では対応していない記述は削除する (::: 記法や一部のコード記法) 記事の公開ステータス及びタグなどについても DEV の記事に反映する1 新規で DEV に記事を同期した Zenn 記事のファイルパスを、 Outputs の newly-sync-articles に設定する (後のジョブで dev_article_id の含まれた記事をコミットしたいため) ワークフローで同期された記事情報は Outouts の articles に設定する Inputs と Outputs の内容一覧については下記になります。\nInputs\nキー 説明 必須 api_key DEV の API Key を設定する o username Zenn の 自分のアカウント名 を設定する (DEV に同期する記事に Zenn のカノニカル URL を設定したい場合のみ) x added_modified_filepath 改行区切りで指定した articles フォルダ内のファイルパスを記載した txt ファイルを指定することで、記載された記事のみを同期するようになる。PR やコミット差分のファイルのみを取得するための GitHub Actions jitterbit/get-changed-files@v1 と組み合わせることで、更新差分のあった記事のみを随時同期することも可能。2 更新差分のあった記事のみを随時同期するための実際のワークフローファイルはこちら x update_all Zenn の全ての記事をどうきするかどうかを設定する。GitHub Actions 初回実行時のみ true にする使い方を想定している。デフォルトは true。added_modified_filepath よりも update_all が優先されるため added_modified_filepath を設定する場合は false を設定する必要あり` x Outputs\nキー 説明 articles 同期された DEV の記事のタイトル及び URL が格納された配列 newly-sync-articles DEV で新たに新規作成された Zenn 記事のファイルパスが格納された配列。実際のワークフローファイルの該当する記述のように、必ずコミットに含めるようにする必要がある (理由は後述) Inputs 及び Outputs については公式サイトの説明をご参照ください。\nZenn の記事を DEV に同期するための仕組み Zenn の記事を新規で DEV に同期する際は、DEV に記事を新規作成する必要があります。その際に Zenn の記事と DEV の記事を紐付けるための何らかの仕組みが必要となります。そうしないと、今後 Zenn の記事内容を更新した際に、DEV のどの記事に内容を同期させればよいかが不明なためです。\nそこで、記事を同期するための仕組みとして、dev_article_id というフィールドを Zenn のマークダウンヘッダに追記することで DEV の同期すべき記事との紐付けを行うことにしました。dev_article_id には DEV の記事作成 API 実行時の返り値である id を設定します。\n一度 id を dev_article_id として Zenn の記事に紐付けてしまえば、次回以降に記事の同期を行う際は DEV の記事更新 API を利用できます。\nまた、Outputs の newly-sync-articles には新規で作成された DEV 記事の id である dev_article_id が追記された Zenn 記事のファイルパスが格納されています。そのため、nikaera/sync-zenn-with-dev-action@v1 実行後は、下記のように steps.dev-to.outputs.newly-sync-articles 内に格納されたファイル群をコミットに反映させる必要があります。\n# `nikaera/sync-zenn-with-dev-action@v1` 実行後に必ず定義すべきジョブ # DEV に新規に作成した記事がなければ実行しない (if: steps.dev-to.outputs.newly-sync-articles) - name: write article id of DEV to articles of Zenn. run: | git config user.name github-actions git config user.email github-actions@github.com git add ${{ steps.dev-to.outputs.newly-sync-articles }} git commit -m \"sync: Zenn with DEV [skip ci]\" git push if: steps.dev-to.outputs.newly-sync-articles 上記のジョブで newly-sync-articles に格納された dev_article_id が追記された Zenn 記事は随時コミットに反映しないと、Zenn の全ての記事が同期毎 DEV に新規作成され続けるという不具合を引き起こしてしまうので、ご注意ください\nGitHub Actions を開発する手順 サクッと開発に取り組みたかったため、Docker コンテナを利用する方法 ではなく、JavaScript を利用する方法 で開発を進めていくことにしました。\nTypeScript で GitHub Actions を作る GitHub 公式が TypeScript で GitHub Actions を作るための テンプレートプロジェクト を用意してくれています。今回はこのテンプレートプロジェクトを利用する形でプロジェクトを作成しました。\n(余談) GitHub Actions では Docker コンテナ を用いてワークフローを実行可能です。そのため、実行環境は自由に設定出来ます。(Go, Python, Ruby, etc.)\n早速 TypeScript のテンプレートプロジェクトを元に自分の GitHub Actions プロジェクトを作成します。\n1. テンプレートプロジェクトを元に GitHub Actions の TypeScript プロジェクトを作成する\n2. プロジェクトの作成後 git clone してきて開発する準備を整える\nGitHub Actions プロジェクトの開発を進めるための準備を行う テンプレートプロジェクトを git clone したら、まずは action.yml の内容を変更します。 今回作成した GitHub Actions の action.yml は下記となっております。\n# action.yml # GitHub Actions のプロジェクト名 name: \"Sync Zenn articles to DEV\" # GitHub Actions のプロジェクト説明文 description: \"Just sync Zenn articles to DEV.\" # GitHub Actions の作者 author: \"nikaera\" # GitHub Actions に渡せる引数の値定義 inputs: api_key: # フィールドの指定が必須であれば true、必須でなければ false を設定する # DEV の API キーは同期を行う際に必須なため、true を設定している required: true # フィールドの説明文 description: \"The api_key required to use the DEV API (https://docs.forem.com/api/#section/Authentication)\" username: required: false description: \"Zenn user's account name. (Fields to be filled in if canonical url is set.)\" articles: required: false description: \"The directory where Zenn articles are stored.\" # フィールドにはデフォルト値を指定することも可能 # Zenn の記事がデフォで格納されているフォルダ名を指定している default: articles update_all: require: false description: \"Whether to synchronize all articles.\" default: true added_modified_filepath: required: false description: | Synchronize only the articles in the file path divided by line breaks. You can use jitterbit/get-changed-files@v1 to get only the file paths of articles that have changed in the correct format. (https://github.com/jitterbit/get-changed-files) # GitHub Actions 実行後に参照可能になる値定義 outputs: articles: description: \"A list of URLs of dev.to articles that have been created or updated\" newly-sync-articles: description: \"File path list of newly synchronized articles.\" # GitHub Actions の実行環境 runs: using: \"node12\" # テンプレートプロジェクトでは コンパイル先が dist になるため `dist/index.js` を指定している main: \"dist/index.js\" TypeScript のテンプレートプロジェクトでは、バンドルツールとして ncc が採用されています。GitHub Actions 実行時に使用されるのは ncc によりコンパイルされた単一の JavaScript ファイル (dist/index.js) になります。\nあとは src フォルダ内でプログラムを書いて、npm run all \u0026\u0026 node dist/index.js のようにコマンド実行しながら開発を進めていくだけです。\n(余談) GitHub Actions の開発ツールとして Docker を利用した act というものが存在するようです。ローカル環境で検証する際は 既知の問題 に対応する必要がありそうですが、GitHub Actions の開発で非常に有効活用できそうで気になっております。\n今回の開発では利用しなかったのですが、今後開発を進めていく中で利用する機会も出てきそうなので、その際は本記事内容を更新する形で知見を追記したいと考えております。\nGitHub Actions を実装する際に利用した機能 GitHub Actions を実装する際に利用した機能を、実際のコード内容を抜粋して簡単に説明していきます。下記で紹介する内容は GitHub Actions Toolkit の機能です。\n// main.ts /** 下記の yml の with で指定した値は core.getInput で受け取ることが可能。 - name: dev.to action step uses: nikaera/sync-zenn-with-dev-action@v1 id: dev-to with: # DEV の API キーを指定する api_key: ${{ secrets.api_key }} */ core.getInput(\"api_key\", { required: true }); core.getInput(\"update_all\", { required: false }); /** 下記の yml の steps.\u003cジョブで指定した id\u003e.outputs で参照可能な値をセットすることが可能。 セットする内容は文字列である必要がある。 - name: dev.to action step uses: nikaera/sync-zenn-with-dev-action@v1 id: dev-to - name: Get the output articles. run: echo \"${{ steps.dev-to.outputs.articles }}\" */ core.setOutput(\"articles\", JSON.stringify(devtoArticles, undefined, 2)); core.setOutput(\"newly-sync-articles\", newlySyncedArticles.join(\" \")); /** GitHub Actions 実行時に出力されるログをレベルごとに出力することが可能 core.debug はローカル実行時のみに出力内容を確認することができる */ core.debug(\"debug\"); core.info(`update_all: ${updateAll}`); core.error(JSON.stringify(error)); 上記だけ把握してれば GitHub Actions の開発は問題なく行うことができました。\n作成した GitHub Actions を実際に GitHub 上で実行可能にする ローカル環境で一通り開発が完了したら、GitHub リポジトリに push した後タグ付けを行います。GitHub Actions はタグを設定しないと実行できないため必要な作業となります。 今回タグ付けは GitHub 上で行いました。\n1. タグの項目をクリックする\n2. Create a new release ボタンをクリックしてタグ作成画面に遷移する\n3. Publish release ボタンをクリックしてタグの作成を完了する\n上記の例では v1 というタグを作成したので nikaera/sync-zenn-with-dev-action@v1 のような記述で GitHub Actions を利用可能になりました。 私は Zenn の記事を zenn.dev というリポジトリで管理しているため、早速このリポジトリに GitHub Actions を導入してみます。\nZenn の全ての記事を DEV に同期するためのワークフロー 本記事の GitHub Actions では DEV の API キーを使用するため、事前にシークレットへ API_KEY という名称で値を登録しておきます。公式サイトの手順 に従い シークレットの登録が完了したら、該当リポジトリに .github/workflows/sync-zenn-with-dev-all.yml というワークフローファイルを作成します。\n# .github/workflows/sync-zenn-with-dev-all.yml name: \"Sync-All Zenn with DEV\" on: workflow_dispatch: jobs: build: runs-on: ubuntu-latest if: contains(github.event.head_commit.message, '[skip ci]') == false steps: - name: setup node project uses: actions/checkout@v2 - name: dev.to action step uses: nikaera/sync-zenn-with-dev-action@v1 id: dev-to with: api_key: ${{ secrets.api_key }} # Zenn の自分のアカウント名を指定すると # DEV 記事のカノニカル URL に Zenn 記事の URL を指定できる # username: nikaera update_all: true - name: write article id of DEV to articles of Zenn. run: | git config user.name github-actions git config user.email github-actions@github.com git add ${{ steps.dev-to.outputs.newly-sync-articles }} git commit -m \"sync: Zenn with DEV [skip ci]\" git push if: steps.dev-to.outputs.newly-sync-articles - name: Get the output articles. run: echo \"${{ steps.dev-to.outputs.articles }}\" 上記は手動実行が可能な Zenn の記事を全て DEV に同期するためのワークフローファイルになります。作成が完了したらワークフローファイルを実行して、記事が正常に同期できているか確認してみます。\n1. Actions タブをクリックする\n2. 作成した Sync-All Zenn with DEV ワークフローファイルを選択する\n3. Run workflow ボタンを実行して、ワークフローを実行する\n4. ワークフローの実行が正常に完了していれば、ログに DEV の記事情報が出力される\n5. dev.to にアクセスして Zenn の記事情報が正常に同期されていることを確認する\n正常に Zenn の全ての記事が DEV に同期されていることが確認できたら、次は Zenn の記事が新規作成されたり、更新されたときのみに DEV に同期するためのワークフローファイルを作成します。\n更新差分のあった Zenn 記事のみを DEV に同期するためのワークフロー main ブランチが更新されたときのみ更新された記事のみを DEV に同期するためのワークフローファイルを作成します。該当リポジトリに .github/workflows/sync-zenn-with-dev.yml というワークフローファイルを作成します。\n# .github/workflows/sync-zenn-with-dev.yml name: \"Sync Zenn with DEV\" on: push: branches: - main jobs: build: runs-on: ubuntu-latest if: contains(github.event.head_commit.message, '[skip ci]') == false steps: - name: setup node project uses: actions/checkout@v2 - name: get modified files id: files uses: jitterbit/get-changed-files@v1 - name: output modified files to text run: | for changed_file in ${{ steps.files.outputs.added_modified }}; do echo \"${changed_file}\" \u003e\u003e added_modified.txt done - name: dev.to action step uses: nikaera/sync-zenn-with-dev-action@v1 id: dev-to with: api_key: ${{ secrets.api_key }} # Zenn の自分のアカウント名を指定すると # DEV 記事のカノニカル URL に Zenn 記事の URL を指定できる # username: nikaera added_modified_filepath: ./added_modified.txt update_all: false - name: write article id of DEV to articles of Zenn. run: | git config user.name github-actions git config user.email github-actions@github.com git add ${{ steps.dev-to.outputs.newly-sync-articles }} git commit -m \"sync: Zenn with DEV [skip ci]\" git push if: steps.dev-to.outputs.newly-sync-articles - name: Get the output articles. run: echo \"${{ steps.dev-to.outputs.articles }}\" 上記ワークフローファイルの作成が完了したら、早速動作確認のために、まさに今執筆中の本記事内容をリポジトリに push してみます。\n1. git push 後に該当するワークフローの実行結果を確認する\n2. dev.to に執筆途中の内容で記事が同期されていることを確認する\nこれまで説明してきた 2 つのワークフローを利用することで、大抵のユースケースはカバーできるはずです。\nおわりに GitHub Actions の勉強のために取り組んだプロジェクトですが、思いの外楽しくて他にも色々な機能のアイデアがあるので随時実装していきたいと考えています。(英訳, タイトルフォーマット変更, etc.)\nDEV に Zenn の記事をクロスポストする GitHub Actions を公開することで、いつもお世話になっている Zenn というプラットフォームを海外の方に認知していただける機会を創出できたのかもと考えたらテンションが上がってきました。\nそれはさておき、Zenn の記事を他でも有効活用するための GitHub Actions を開発する際には、恐らく本記事で紹介した GitHub Actions のコードが参考になるはずです。\nまた、GitHub Actions の Marketplace というものが用意されているようなので、開発がある程度完了次第、こちらに申請するのも試してみたいと考えております。\n参考リンク DEV Community 👩‍💻👨‍💻 dev.to supports canonical URLs so you can share content without impacting SEO... - DEV Community nikaera/sync-zenn-with-dev-action: Just sync Zenn articles to DEV. DEV API (beta) jitterbit/get-changed-files: Get all of the files changed/modified in a pull request or push’s commits. Docker コンテナのアクションを作成する - GitHub Docs JavaScript アクションを作成する - GitHub Docs actions/typescript-action: Create a TypeScript Action with tests, linting, workflow, publishing, and versioning vercel/ncc: Compile a Node.js project into a single file. Supports TypeScript, binary addons, dynamic requires. nektos/act: Run your GitHub Actions locally 🚀 actions/toolkit: The GitHub ToolKit for developing GitHub Actions. 暗号化されたシークレット - GitHub Docs DeepL Pro：テキストの他、Word などの文書をセキュアに翻訳 Qiita Crieit - プログラマー、クリエイターが何でも気軽に書けるコミュニティ DEV (Forem) の仕様上、タグは最大でも 4 つまでしか設定できないため、Zenn で設定したタグの先頭 4 つまで DEV の記事には設定しています ↩︎\n当然といえば当然ですが jitterbit/get-changed-files@v1 は workflow_dispatch でワークフローを手動実行した際や、force push 等でファイル差分を正確に特定できない操作には対応しておりませんので、その場合はエラーが発生します ↩︎\n","wordCount":"1443","inLanguage":"ja","image":"https://nikaera.com/cover_image.jpg","datePublished":"2021-03-21T00:00:00Z","dateModified":"2021-03-21T00:00:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://nikaera.com/archives/sync-zenn-with-dev-action/"},"publisher":{"@type":"Organization","name":"Nikaeraintokyo.","logo":{"@type":"ImageObject","url":"https://nikaera.com/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://nikaera.com/ accesskey=h title="Nikaeraintokyo. (Alt + H)">Nikaeraintokyo.</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></span></div><ul id=menu><li><a href=https://nikaera.tumblr.com/ title="Music 🎵" target=_blank rel="noopener noreferrer"><span>Music 🎵</span></a></li><li><span>|</span></li><li><a href=https://nikaera.com/archives/ title="Archives 🗄️"><span>Archives 🗄️</span></a></li><li><a href=https://nikaera.com/rss_feeds/ title="RSS Feeds 🔖"><span>RSS Feeds 🔖</span></a></li><li><a href=https://nikaera.com/profile/ title="Profile 👦"><span>Profile 👦</span></a></li><li><a href=https://nikaera.com/portfolio/ title="Portfolio 💼"><span>Portfolio 💼</span></a></li><li><a href=https://nikaera.com/contact/ title="Contact 📥"><span>Contact 📥</span></a></li><li><a href=https://nikaera.com/search/ title="Search 🔍"><span>Search 🔍</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>📔 Zenn の記事を DEV に自動的に同期させる GitHub Actions 作ってみた</h1><div class=post-meta><span title='2021-03-21 00:00:00 +0000 UTC'>3月 21, 2021</span>&nbsp;·&nbsp;7 分&nbsp;·&nbsp;Me
<span style=text-align:right;margin-left:auto;font-size:1em>Originally published at <a href=https://zenn.dev/nikaera/articles/sync-zenn-with-dev-action target=_blank rel="noopener noreferrer">zenn.dev</a></span></div></header><div class=post-content><h1 id=はじめに>はじめに<a hidden class=anchor aria-hidden=true href=#はじめに>#</a></h1><p>去年 <a href=https://dev.to/>DEV</a> のアカウントを作成したものの、今まで全く有効活用出来ていませんでした。</p><p>DEV には <a href=https://dev.to/michaelburrows/comment/125j0>カノニカル URL</a> を設定出来るので、常々 Zenn の記事を投稿する際にクロスポストしたいなと考えておりました。そこで、<strong>Zenn に記事を投稿したら、自動的に DEV にも記事を投稿 & 同期する GitHub Actions を作ってみました。</strong></p><div class=linkcard-container style=margin:var(--content-gap)0><a href=https://github.com/nikaera/sync-zenn-with-dev-action class=linkcard style="display:flex;text-decoration:none;color:var(--content);background:var(--entry);border:1px solid var(--border);border-radius:12px;padding:0 0 0 20px;transition:background-color .3s ease;box-shadow:0 4px 8px rgba(0,0,0,8%);min-height:140px;overflow:hidden" onmouseover='this.style.backgroundColor="rgb(56, 56, 61)"' onmouseout='this.style.backgroundColor="var(--entry)"' target=_blank rel="noopener noreferrer"><div class=linkcard-content style=flex:1;display:flex;flex-direction:column;min-width:0;margin-top:20px;margin-right:20px><div class=linkcard-title style=margin-bottom:10px><h3 style=margin:0;font-size:18px;font-weight:600;line-height:1.3;color:var(--primary);overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;line-clamp:2>GitHub - nikaera/sync-zenn-with-dev-action: Just sync Zenn articles to DEV.</h3></div><p class=linkcard-description style=margin:0;font-size:14px;line-height:1.5;color:var(--secondary);overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;line-clamp:2;flex:1;margin-bottom:12px>Just sync Zenn articles to DEV. Contribute to nikaera/sync-zenn-with-dev-action development by creating an account on GitHub.</p><div class=linkcard-domain style=margin-top:auto;font-size:13px;color:#f5f5f5;font-weight:500;display:flex;align-items:center><img src="https://www.google.com/s2/favicons?domain=github.com&amp;sz=16" alt="github.com favicon" style=width:18px;height:18px;margin-right:8px;flex-shrink:0;border-radius:3px loading=lazy onerror='this.onerror=null,this.src="https://github.githubassets.com/favicons/favicon",this.onerror=function(){this.style.display="none"}'>github.com</div></div><div class=linkcard-thumbnail style=flex-shrink:0;width:25%;min-width:140px;position:relative><img src=https://repository-images.githubusercontent.com/349789739/f609bd00-8c14-11eb-8997-d118d83366d7 alt="GitHub - nikaera/sync-zenn-with-dev-action: Just sync Zenn articles to DEV." style=width:100%;height:100%;margin:0;object-fit:cover;border-radius:0;background:var(--code-bg) loading=lazy></div></a></div><p>今回初めて GitHub Actions を自作したのですが、その中で得た知見を残す形で記事を書くことにしました。また、GitHub Actions は TypeScript で作成しました。</p><h1 id=開発した-github-actions-の概要>開発した GitHub Actions の概要<a hidden class=anchor aria-hidden=true href=#開発した-github-actions-の概要>#</a></h1><p>まずはザッとどのような GitHub Actions を作成したのか、概要について説明いたします。</p><p><strong>GitHub リポジトリで管理している Zenn の記事を DEV に同期して投稿する GitHub Actions を作成しました。</strong> その際に DEV へ投稿する記事には Zenn の該当記事へのカノニカル URL も自動で設定できます。これにより DEV と Zenn へ記事をシームレスにクロスポストすることが可能となります。</p><p>今回作成した GitHub Actions を利用するワークフローファイルの一例は下記となります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#75715e># .github/workflows/sync-zenn-with-dev-all.yml</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;Sync all Zenn articles to DEV&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>branches</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>checkout my project</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dev.to action step</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>nikaera/sync-zenn-with-dev-action@v1</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># id を設定することで、後のジョブで Output で指定した値が参照可能になる</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>id</span>: <span style=color:#ae81ff>dev-to</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#75715e># DEV の API キーを指定する</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>api_key</span>: <span style=color:#ae81ff>${{ secrets.api_key }}</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># (オプション) DEV に記事を投稿した際に Zenn のカノニカル URL を設定したい場合に指定する</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># username: nikaera</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># (オプション) 改行区切りで指定した articles フォルダ内のファイルパスを記載した txt ファイルを指定することで、記載された記事のみを同期するようになる。</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># 他プラグインと組み合わせることで差分のみを txt ファイルに載せることが可能。詳細については後述の Outputs の項目に記載。</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># added_modified_filepath: ./added_modified.txt</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># (オプション) Zenn の articles 以下全ての記事を常に DEV に同期するか指定する</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># update_all が true のときは added_modified_filepath は無視される。</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># update_all: false</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 上記アクション実行時に DEV に新規で同期する記事に関しては Zenn のマークダウンヘッダに</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 該当する DEV の記事の ID が dev_article_id として記載されるようになる。</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 今後はその ID を元に同期するようになるため、該当する Zenn の記事をコミットする。</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 新規で同期する記事が無ければ、このジョブは実行しない。</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>write article id of DEV to articles of Zenn.</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git config user.name github-actions
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git config user.email github-actions@github.com
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git add ${{ steps.dev-to.outputs.newly-sync-articles }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git commit -m &#34;sync: Zenn with DEV [skip ci]&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git push</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>if</span>: <span style=color:#ae81ff>steps.dev-to.outputs.newly-sync-articles</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Outputs には DEV の記事情報 (title, url) が含まれるようになるため、</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 最後に出力して実行結果の内容を確認することもできる</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Get the output articles.</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># dev-to という id が紐付いたジョブの Outputs を取得して echo で内容を出力する</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>echo &#34;${{ steps.dev-to.outputs.articles }}&#34;</span>
</span></span></code></pre></div><p>簡単に <code>nikaera/sync-zenn-with-dev-action@v1</code> というジョブの内部処理について説明いたします。</p><ol><li>Inputs の <code>update_all</code> 及び <code>added_modified_filepath</code> で受け取った情報を元に、
どの記事を DEV に同期させるか判定する</li><li>DEV に同期する記事のファイルパス一覧を取得して、
それぞれの記事のヘッダに <code>dev_article_id</code> の記載があるか判定する</li><li>Inputs の <code>api_key</code> を利用して、Zenn の記事に <code>dev_article_id</code> が含まれていれば、
該当する DEV の記事を更新する。含まれていなければ DEV に新規で記事を作成する</li><li>Inputs の <code>username</code> を利用して、
DEV の記事に該当する Zenn 記事のカノニカル URL を設定する</li><li>DEV に新規で記事を作成した場合は、
Zenn の該当記事のヘッダに <code>dev_article_id</code> を書き込む</li><li>DEV に記事を投稿する際、Zenn は対応しているが、
DEV では対応していない記述は削除する (<code>:::</code> 記法や一部のコード記法)</li><li>記事の公開ステータス及びタグなどについても DEV の記事に反映する<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></li><li>新規で DEV に記事を同期した Zenn 記事のファイルパスを、
Outputs の <code>newly-sync-articles</code> に設定する
(後のジョブで <code>dev_article_id</code> の含まれた記事をコミットしたいため)</li><li>ワークフローで同期された記事情報は Outouts の <code>articles</code> に設定する</li></ol><p>Inputs と Outputs の内容一覧については下記になります。</p><p><strong>Inputs</strong></p><table><thead><tr><th style=text-align:left>キー</th><th style=text-align:left>説明</th><th style=text-align:center>必須</th></tr></thead><tbody><tr><td style=text-align:left>api_key</td><td style=text-align:left>DEV の <a href=https://docs.forem.com/api/#section/Authentication>API Key</a> を設定する</td><td style=text-align:center>o</td></tr><tr><td style=text-align:left>username</td><td style=text-align:left>Zenn の <strong>自分のアカウント名</strong> を設定する (DEV に同期する記事に Zenn のカノニカル URL を設定したい場合のみ)</td><td style=text-align:center>x</td></tr><tr><td style=text-align:left>added_modified_filepath</td><td style=text-align:left>改行区切りで指定した articles フォルダ内のファイルパスを記載した txt ファイルを指定することで、記載された記事のみを同期するようになる。<strong>PR やコミット差分のファイルのみを取得するための GitHub Actions <a href=https://github.com/jitterbit/get-changed-files>jitterbit/get-changed-files@v1</a> と組み合わせることで、更新差分のあった記事のみを随時同期することも可能。<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></strong> 更新差分のあった記事のみを随時同期するための<a href=https://github.com/nikaera/zenn.dev/blob/main/.github/workflows/sync-zenn-with-dev.yml>実際のワークフローファイルはこちら</a></td><td style=text-align:center>x</td></tr><tr><td style=text-align:left>update_all</td><td style=text-align:left>Zenn の全ての記事をどうきするかどうかを設定する。GitHub Actions 初回実行時のみ true にする使い方を想定している。デフォルトは true。<strong><code>added_modified_filepath</code> よりも <code>update_all</code> が優先されるため <code>added_modified_filepath</code> を設定する場合は false を設定する必要あり`</strong></td><td style=text-align:center>x</td></tr></tbody></table><p><strong>Outputs</strong></p><table><thead><tr><th style=text-align:left>キー</th><th style=text-align:left>説明</th></tr></thead><tbody><tr><td style=text-align:left>articles</td><td style=text-align:left>同期された DEV の記事のタイトル及び URL が格納された配列</td></tr><tr><td style=text-align:left>newly-sync-articles</td><td style=text-align:left>DEV で新たに新規作成された Zenn 記事のファイルパスが格納された配列。<strong><a href=https://github.com/nikaera/sync-zenn-with-dev-action/blob/main/.github/workflows/test.yml#L31-L38>実際のワークフローファイルの該当する記述</a>のように、必ずコミットに含めるようにする必要がある (理由は後述)</strong></td></tr></tbody></table><p>Inputs 及び Outputs については<a href=https://docs.github.com/ja/actions/creating-actions/metadata-syntax-for-github-actions>公式サイトの説明</a>をご参照ください。</p><h2 id=zenn-の記事を-dev-に同期するための仕組み>Zenn の記事を DEV に同期するための仕組み<a hidden class=anchor aria-hidden=true href=#zenn-の記事を-dev-に同期するための仕組み>#</a></h2><p>Zenn の記事を新規で DEV に同期する際は、DEV に記事を新規作成する必要があります。<strong>その際に Zenn の記事と DEV の記事を紐付けるための何らかの仕組みが必要となります。そうしないと、今後 Zenn の記事内容を更新した際に、DEV のどの記事に内容を同期させればよいかが不明なためです。</strong></p><p>そこで、記事を同期するための仕組みとして、<strong><code>dev_article_id</code> というフィールドを Zenn のマークダウンヘッダに追記することで DEV の同期すべき記事との紐付けを行うことにしました。</strong><code>dev_article_id</code> には <a href=https://docs.forem.com/api/#operation/createArticle>DEV の記事作成 API</a> 実行時の返り値である <code>id</code> を設定します。</p><p>一度 <code>id</code> を <code>dev_article_id</code> として Zenn の記事に紐付けてしまえば、次回以降に記事の同期を行う際は <a href=https://docs.forem.com/api/#operation/updateArticle>DEV の記事更新 API</a> を利用できます。</p><p>また、<strong>Outputs の <code>newly-sync-articles</code> には新規で作成された DEV 記事の <code>id</code> である <code>dev_article_id</code> が追記された Zenn 記事のファイルパスが格納されています。そのため、<code>nikaera/sync-zenn-with-dev-action@v1</code> 実行後は、下記のように <code>steps.dev-to.outputs.newly-sync-articles</code> 内に格納されたファイル群をコミットに反映させる必要があります。</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#75715e># `nikaera/sync-zenn-with-dev-action@v1` 実行後に必ず定義すべきジョブ</span>
</span></span><span style=display:flex><span><span style=color:#75715e># DEV に新規に作成した記事がなければ実行しない (if: steps.dev-to.outputs.newly-sync-articles)</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>write article id of DEV to articles of Zenn.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        git config user.name github-actions
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        git config user.email github-actions@github.com
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        git add ${{ steps.dev-to.outputs.newly-sync-articles }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        git commit -m &#34;sync: Zenn with DEV [skip ci]&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        git push</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>if</span>: <span style=color:#ae81ff>steps.dev-to.outputs.newly-sync-articles</span>
</span></span></code></pre></div><p><em>上記のジョブで <code>newly-sync-articles</code> に格納された <code>dev_article_id</code> が追記された Zenn 記事は随時コミットに反映しないと、<strong>Zenn の全ての記事が同期毎 DEV に新規作成され続けるという不具合を引き起こしてしまうので、ご注意ください</strong></em></p><h1 id=github-actions-を開発する手順>GitHub Actions を開発する手順<a hidden class=anchor aria-hidden=true href=#github-actions-を開発する手順>#</a></h1><p>サクッと開発に取り組みたかったため、<a href=https://docs.github.com/ja/actions/creating-actions/creating-a-docker-container-action>Docker コンテナを利用する方法</a> ではなく、<a href=https://docs.github.com/ja/actions/creating-actions/creating-a-javascript-action>JavaScript を利用する方法</a> で開発を進めていくことにしました。</p><h2 id=typescript-で-github-actions-を作る>TypeScript で GitHub Actions を作る<a hidden class=anchor aria-hidden=true href=#typescript-で-github-actions-を作る>#</a></h2><p>GitHub 公式が TypeScript で GitHub Actions を作るための <a href=https://github.com/actions/typescript-action>テンプレートプロジェクト</a> を用意してくれています。今回はこのテンプレートプロジェクトを利用する形でプロジェクトを作成しました。</p><hr><p><em>(余談) GitHub Actions では <a href=https://docs.github.com/ja/actions/creating-actions/creating-a-docker-container-action>Docker コンテナ</a> を用いてワークフローを実行可能です。<strong>そのため、実行環境は自由に設定出来ます。(Go, Python, Ruby, etc.)</strong></em></p><hr><p>早速 TypeScript のテンプレートプロジェクトを元に自分の GitHub Actions プロジェクトを作成します。</p><p><img alt="スクリーンショット 2021-03-21 13.25.54.png" loading=lazy src=https://i.gyazo.com/359f6f795bab9807c9f480c0f922973a.png>
<strong>1. テンプレートプロジェクトを元に GitHub Actions の TypeScript プロジェクトを作成する</strong></p><p><img alt="スクリーンショット 2021-03-21 13.29.43.png" loading=lazy src=https://i.gyazo.com/76aecd3d63db95d34c086774ded122d4.png>
<strong>2. プロジェクトの作成後 <code>git clone</code> してきて開発する準備を整える</strong></p><h2 id=github-actions-プロジェクトの開発を進めるための準備を行う>GitHub Actions プロジェクトの開発を進めるための準備を行う<a hidden class=anchor aria-hidden=true href=#github-actions-プロジェクトの開発を進めるための準備を行う>#</a></h2><p>テンプレートプロジェクトを <code>git clone</code> したら、まずは <code>action.yml</code> の内容を変更します。
今回作成した GitHub Actions の <code>action.yml</code> は下記となっております。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#75715e># action.yml</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># GitHub Actions のプロジェクト名</span>
</span></span><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;Sync Zenn articles to DEV&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># GitHub Actions のプロジェクト説明文</span>
</span></span><span style=display:flex><span><span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;Just sync Zenn articles to DEV.&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># GitHub Actions の作者</span>
</span></span><span style=display:flex><span><span style=color:#f92672>author</span>: <span style=color:#e6db74>&#34;nikaera&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># GitHub Actions に渡せる引数の値定義</span>
</span></span><span style=display:flex><span><span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>api_key</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># フィールドの指定が必須であれば true、必須でなければ false を設定する</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># DEV の API キーは同期を行う際に必須なため、true を設定している</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>required</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># フィールドの説明文</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;The api_key required to use the DEV API (https://docs.forem.com/api/#section/Authentication)&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>username</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>required</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;Zenn user&#39;s account name. (Fields to be filled in if canonical url is set.)&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>articles</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>required</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;The directory where Zenn articles are stored.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># フィールドにはデフォルト値を指定することも可能</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Zenn の記事がデフォで格納されているフォルダ名を指定している</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>default</span>: <span style=color:#ae81ff>articles</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>update_all</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>require</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;Whether to synchronize all articles.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>default</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>added_modified_filepath</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>required</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      Synchronize only the articles in the file path divided by line breaks.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      You can use jitterbit/get-changed-files@v1 to get only the file paths of articles that have changed in the correct format.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      (https://github.com/jitterbit/get-changed-files)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># GitHub Actions 実行後に参照可能になる値定義</span>
</span></span><span style=display:flex><span><span style=color:#f92672>outputs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>articles</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;A list of URLs of dev.to articles that have been created or updated&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>newly-sync-articles</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;File path list of newly synchronized articles.&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># GitHub Actions の実行環境</span>
</span></span><span style=display:flex><span><span style=color:#f92672>runs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>using</span>: <span style=color:#e6db74>&#34;node12&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># テンプレートプロジェクトでは コンパイル先が dist になるため `dist/index.js` を指定している</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>main</span>: <span style=color:#e6db74>&#34;dist/index.js&#34;</span>
</span></span></code></pre></div><p>TypeScript のテンプレートプロジェクトでは、バンドルツールとして <a href=https://github.com/vercel/ncc><code>ncc</code></a> が採用されています。<strong>GitHub Actions 実行時に使用されるのは ncc によりコンパイルされた単一の JavaScript ファイル (<code>dist/index.js</code>) になります。</strong></p><p>あとは <code>src</code> フォルダ内でプログラムを書いて、<code>npm run all && node dist/index.js</code> のようにコマンド実行しながら開発を進めていくだけです。</p><hr><p><em>(余談) GitHub Actions の開発ツールとして Docker を利用した <a href=https://github.com/nektos/act><code>act</code></a> というものが存在するようです。ローカル環境で検証する際は <a href=https://github.com/nektos/act#known-issues>既知の問題</a> に対応する必要がありそうですが、GitHub Actions の開発で非常に有効活用できそうで気になっております。</em></p><p><em>今回の開発では利用しなかったのですが、今後開発を進めていく中で利用する機会も出てきそうなので、その際は本記事内容を更新する形で知見を追記したいと考えております。</em></p><h2 id=github-actions-を実装する際に利用した機能>GitHub Actions を実装する際に利用した機能<a hidden class=anchor aria-hidden=true href=#github-actions-を実装する際に利用した機能>#</a></h2><p>GitHub Actions を実装する際に利用した機能を、実際のコード内容を抜粋して簡単に説明していきます。下記で紹介する内容は <a href=https://github.com/actions/toolkit>GitHub Actions Toolkit</a> の機能です。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// main.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>下記の yml の with で指定した値は core.getInput で受け取ることが可能。
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>- name: dev.to action step
</span></span></span><span style=display:flex><span><span style=color:#75715e>    uses: nikaera/sync-zenn-with-dev-action@v1
</span></span></span><span style=display:flex><span><span style=color:#75715e>    id: dev-to
</span></span></span><span style=display:flex><span><span style=color:#75715e>    with:
</span></span></span><span style=display:flex><span><span style=color:#75715e>        # DEV の API キーを指定する
</span></span></span><span style=display:flex><span><span style=color:#75715e>        api_key: ${{ secrets.api_key }}
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>core</span>.<span style=color:#a6e22e>getInput</span>(<span style=color:#e6db74>&#34;api_key&#34;</span>, { <span style=color:#a6e22e>required</span>: <span style=color:#66d9ef>true</span> });
</span></span><span style=display:flex><span><span style=color:#a6e22e>core</span>.<span style=color:#a6e22e>getInput</span>(<span style=color:#e6db74>&#34;update_all&#34;</span>, { <span style=color:#a6e22e>required</span>: <span style=color:#66d9ef>false</span> });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>下記の yml の steps.&lt;ジョブで指定した id&gt;.outputs で参照可能な値をセットすることが可能。
</span></span></span><span style=display:flex><span><span style=color:#75715e>セットする内容は文字列である必要がある。
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>- name: dev.to action step
</span></span></span><span style=display:flex><span><span style=color:#75715e>    uses: nikaera/sync-zenn-with-dev-action@v1
</span></span></span><span style=display:flex><span><span style=color:#75715e>    id: dev-to
</span></span></span><span style=display:flex><span><span style=color:#75715e>- name: Get the output articles.
</span></span></span><span style=display:flex><span><span style=color:#75715e>    run: echo &#34;${{ steps.dev-to.outputs.articles }}&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>core</span>.<span style=color:#a6e22e>setOutput</span>(<span style=color:#e6db74>&#34;articles&#34;</span>, <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>devtoArticles</span>, <span style=color:#66d9ef>undefined</span>, <span style=color:#ae81ff>2</span>));
</span></span><span style=display:flex><span><span style=color:#a6e22e>core</span>.<span style=color:#a6e22e>setOutput</span>(<span style=color:#e6db74>&#34;newly-sync-articles&#34;</span>, <span style=color:#a6e22e>newlySyncedArticles</span>.<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#34; &#34;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>GitHub Actions 実行時に出力されるログをレベルごとに出力することが可能
</span></span></span><span style=display:flex><span><span style=color:#75715e>core.debug はローカル実行時のみに出力内容を確認することができる
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>core</span>.<span style=color:#a6e22e>debug</span>(<span style=color:#e6db74>&#34;debug&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>core</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>`update_all: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>updateAll</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>core</span>.<span style=color:#a6e22e>error</span>(<span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>error</span>));
</span></span></code></pre></div><p>上記だけ把握してれば GitHub Actions の開発は問題なく行うことができました。</p><h1 id=作成した-github-actions-を実際に-github-上で実行可能にする>作成した GitHub Actions を実際に GitHub 上で実行可能にする<a hidden class=anchor aria-hidden=true href=#作成した-github-actions-を実際に-github-上で実行可能にする>#</a></h1><p>ローカル環境で一通り開発が完了したら、GitHub リポジトリに push した後タグ付けを行います。<strong>GitHub Actions はタグを設定しないと実行できないため必要な作業となります。</strong> 今回タグ付けは GitHub 上で行いました。</p><p><img alt="スクリーンショット 2021-03-22 8.11.58.png" loading=lazy src=https://i.gyazo.com/252514cca20470154475db75b133e9b3.png>
<strong>1. タグの項目をクリックする</strong></p><p><img alt="スクリーンショット 2021-03-22 8.14.47.png" loading=lazy src=https://i.gyazo.com/a8c145f8d6ae7b1f6253eb4866bcbb51.png>
<strong>2. <code>Create a new release</code> ボタンをクリックしてタグ作成画面に遷移する</strong></p><p><img alt="スクリーンショット 2021-03-22 8.20.00.png" loading=lazy src=https://i.gyazo.com/25e019e42227ad7e0b0b634e68bb1873.png>
<strong>3. <code>Publish release</code> ボタンをクリックしてタグの作成を完了する</strong></p><p><strong>上記の例では <code>v1</code> というタグを作成したので <code>nikaera/sync-zenn-with-dev-action@v1</code> のような記述で GitHub Actions を利用可能になりました。</strong> 私は Zenn の記事を <a href=https://github.com/nikaera/zenn.dev/><code>zenn.dev</code></a> というリポジトリで管理しているため、早速このリポジトリに GitHub Actions を導入してみます。</p><h2 id=zenn-の全ての記事を-dev-に同期するためのワークフロー>Zenn の全ての記事を DEV に同期するためのワークフロー<a hidden class=anchor aria-hidden=true href=#zenn-の全ての記事を-dev-に同期するためのワークフロー>#</a></h2><p>本記事の GitHub Actions では DEV の API キーを使用するため、<strong>事前にシークレットへ <code>API_KEY</code> という名称で値を登録しておきます。</strong><a href=https://docs.github.com/ja/actions/reference/encrypted-secrets#creating-encrypted-secrets-for-a-repository>公式サイトの手順</a> に従い シークレットの登録が完了したら、該当リポジトリに <code>.github/workflows/sync-zenn-with-dev-all.yml</code> というワークフローファイルを作成します。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#75715e># .github/workflows/sync-zenn-with-dev-all.yml</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;Sync-All Zenn with DEV&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>workflow_dispatch</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>if</span>: <span style=color:#ae81ff>contains(github.event.head_commit.message, &#39;[skip ci]&#39;) == false</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>setup node project</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dev.to action step</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>nikaera/sync-zenn-with-dev-action@v1</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>id</span>: <span style=color:#ae81ff>dev-to</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>api_key</span>: <span style=color:#ae81ff>${{ secrets.api_key }}</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># Zenn の自分のアカウント名を指定すると</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># DEV 記事のカノニカル URL に Zenn 記事の URL を指定できる</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># username: nikaera</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>update_all</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>write article id of DEV to articles of Zenn.</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git config user.name github-actions
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git config user.email github-actions@github.com
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git add ${{ steps.dev-to.outputs.newly-sync-articles }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git commit -m &#34;sync: Zenn with DEV [skip ci]&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git push</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>if</span>: <span style=color:#ae81ff>steps.dev-to.outputs.newly-sync-articles</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Get the output articles.</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>echo &#34;${{ steps.dev-to.outputs.articles }}&#34;</span>
</span></span></code></pre></div><p>上記は手動実行が可能な Zenn の記事を全て DEV に同期するためのワークフローファイルになります。作成が完了したらワークフローファイルを実行して、記事が正常に同期できているか確認してみます。</p><p><img alt="スクリーンショット 2021-03-22 8.35.38.png" loading=lazy src=https://i.gyazo.com/e0740fe369752db67514e0ab50e88772.png>
<strong>1. <code>Actions</code> タブをクリックする</strong></p><p><img alt="スクリーンショット 2021-03-22 8.37.24.png" loading=lazy src=https://i.gyazo.com/2aeadddccf08c0dddc54dddab464edee.png>
<strong>2. 作成した <code>Sync-All Zenn with DEV</code> ワークフローファイルを選択する</strong></p><p><img alt="スクリーンショット 2021-03-22 8.40.11.png" loading=lazy src=https://i.gyazo.com/d9e138de1f6e0baac8b0c3bc6742f4f2.png>
<strong>3. <code>Run workflow</code> ボタンを実行して、ワークフローを実行する</strong></p><p><img alt="スクリーンショット 2021-03-22 8.45.23.png" loading=lazy src=https://i.gyazo.com/e67df0f6e33d1f57a46000d20ef2c824.png>
<strong>4. ワークフローの実行が正常に完了していれば、ログに DEV の記事情報が出力される</strong></p><p><img alt="スクリーンショット 2021-03-22 8.50.37.png" loading=lazy src=https://i.gyazo.com/4acc0b0de3acd6731918a9347e7baea8.png>
<strong>5. <code>dev.to</code> にアクセスして Zenn の記事情報が正常に同期されていることを確認する</strong></p><p>正常に Zenn の全ての記事が DEV に同期されていることが確認できたら、次は Zenn の記事が新規作成されたり、更新されたときのみに DEV に同期するためのワークフローファイルを作成します。</p><h2 id=更新差分のあった-zenn-記事のみを-dev-に同期するためのワークフロー>更新差分のあった Zenn 記事のみを DEV に同期するためのワークフロー<a hidden class=anchor aria-hidden=true href=#更新差分のあった-zenn-記事のみを-dev-に同期するためのワークフロー>#</a></h2><p><code>main</code> ブランチが更新されたときのみ更新された記事のみを DEV に同期するためのワークフローファイルを作成します。該当リポジトリに <code>.github/workflows/sync-zenn-with-dev.yml</code> というワークフローファイルを作成します。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#75715e># .github/workflows/sync-zenn-with-dev.yml</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;Sync Zenn with DEV&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>branches</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>if</span>: <span style=color:#ae81ff>contains(github.event.head_commit.message, &#39;[skip ci]&#39;) == false</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>setup node project</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>get modified files</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>id</span>: <span style=color:#ae81ff>files</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>jitterbit/get-changed-files@v1</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>output modified files to text</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          for changed_file in ${{ steps.files.outputs.added_modified }}; do
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            echo &#34;${changed_file}&#34; &gt;&gt; added_modified.txt
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          done</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dev.to action step</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>nikaera/sync-zenn-with-dev-action@v1</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>id</span>: <span style=color:#ae81ff>dev-to</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>api_key</span>: <span style=color:#ae81ff>${{ secrets.api_key }}</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># Zenn の自分のアカウント名を指定すると</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># DEV 記事のカノニカル URL に Zenn 記事の URL を指定できる</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># username: nikaera</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>added_modified_filepath</span>: <span style=color:#ae81ff>./added_modified.txt</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>update_all</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>write article id of DEV to articles of Zenn.</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git config user.name github-actions
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git config user.email github-actions@github.com
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git add ${{ steps.dev-to.outputs.newly-sync-articles }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git commit -m &#34;sync: Zenn with DEV [skip ci]&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git push</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>if</span>: <span style=color:#ae81ff>steps.dev-to.outputs.newly-sync-articles</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Get the output articles.</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>echo &#34;${{ steps.dev-to.outputs.articles }}&#34;</span>
</span></span></code></pre></div><p>上記ワークフローファイルの作成が完了したら、早速動作確認のために、<strong>まさに今執筆中の本記事内容をリポジトリに push してみます。</strong></p><p><img alt="スクリーンショット 2021-03-22 9.07.55.png" loading=lazy src=https://i.gyazo.com/36512e7874b49edc1e48f0ef88af5d89.png>
<strong>1. <code>git push</code> 後に該当するワークフローの実行結果を確認する</strong></p><p><img alt="Image from Gyazo" loading=lazy src=https://i.gyazo.com/cbb0a1cf7b94605680e39630dded0096.png>
<strong>2. <code>dev.to</code> に執筆途中の内容で記事が同期されていることを確認する</strong></p><p>これまで説明してきた 2 つのワークフローを利用することで、大抵のユースケースはカバーできるはずです。</p><h1 id=おわりに>おわりに<a hidden class=anchor aria-hidden=true href=#おわりに>#</a></h1><p>GitHub Actions の勉強のために取り組んだプロジェクトですが、思いの外楽しくて他にも色々な機能のアイデアがあるので随時実装していきたいと考えています。(英訳, タイトルフォーマット変更, etc.)</p><p>DEV に Zenn の記事をクロスポストする GitHub Actions を公開することで、いつもお世話になっている Zenn というプラットフォームを海外の方に認知していただける機会を創出できたのかもと考えたらテンションが上がってきました。</p><p>それはさておき、Zenn の記事を他でも有効活用するための GitHub Actions を開発する際には、恐らく本記事で紹介した GitHub Actions のコードが参考になるはずです。</p><p>また、<a href=https://docs.github.com/ja/actions/creating-actions/publishing-actions-in-github-marketplace>GitHub Actions の Marketplace</a> というものが用意されているようなので、開発がある程度完了次第、こちらに申請するのも試してみたいと考えております。</p><h1 id=参考リンク>参考リンク<a hidden class=anchor aria-hidden=true href=#参考リンク>#</a></h1><ul><li><a href=https://dev.to/>DEV Community 👩‍💻👨‍💻</a></li><li><a href=https://dev.to/michaelburrows/comment/125j0>dev.to supports canonical URLs so you can share content without impacting SEO... - DEV Community</a></li><li><a href=https://github.com/nikaera/sync-zenn-with-dev-action>nikaera/sync-zenn-with-dev-action: Just sync Zenn articles to DEV.</a></li><li><a href=https://docs.forem.com/api/#section/Authentication>DEV API (beta)</a></li><li><a href=https://github.com/jitterbit/get-changed-files>jitterbit/get-changed-files: Get all of the files changed/modified in a pull request or push&rsquo;s commits.</a></li><li><a href=https://docs.github.com/ja/actions/creating-actions/creating-a-docker-container-action>Docker コンテナのアクションを作成する - GitHub Docs</a></li><li><a href=https://docs.github.com/ja/actions/creating-actions/creating-a-javascript-action>JavaScript アクションを作成する - GitHub Docs</a></li><li><a href=https://github.com/actions/typescript-action>actions/typescript-action: Create a TypeScript Action with tests, linting, workflow, publishing, and versioning</a></li><li><a href=https://github.com/vercel/ncc>vercel/ncc: Compile a Node.js project into a single file. Supports TypeScript, binary addons, dynamic requires.</a></li><li><a href=https://github.com/nektos/act>nektos/act: Run your GitHub Actions locally 🚀</a></li><li><a href=https://github.com/actions/toolkit>actions/toolkit: The GitHub ToolKit for developing GitHub Actions.</a></li><li><a href=https://docs.github.com/ja/actions/reference/encrypted-secrets#creating-encrypted-secrets-for-a-repository>暗号化されたシークレット - GitHub Docs</a></li><li><a href=https://www.deepl.com/ja/pro#developer>DeepL Pro：テキストの他、Word などの文書をセキュアに翻訳</a></li><li><a href=https://qiita.com/>Qiita</a></li><li><a href=https://crieit.net/advent-calendars/2020/crieit>Crieit - プログラマー、クリエイターが何でも気軽に書けるコミュニティ</a></li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>DEV (Forem) の仕様上、<a href=https://dev.to/p/editor_guide#front-matter>タグは最大でも 4 つまで</a>しか設定できないため、Zenn で設定したタグの先頭 4 つまで DEV の記事には設定しています&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>当然といえば当然ですが <a href=https://github.com/jitterbit/get-changed-files>jitterbit/get-changed-files@v1</a> は <code>workflow_dispatch</code> でワークフローを手動実行した際や、<code>force push</code> 等でファイル差分を正確に特定できない操作には対応しておりませんので、その場合はエラーが発生します&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://nikaera.com/tags/typescript/>Typescript</a></li><li><a href=https://nikaera.com/tags/githubactions/>Githubactions</a></li><li><a href=https://nikaera.com/tags/forem/>Forem</a></li></ul><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share 📔 Zenn の記事を DEV に自動的に同期させる GitHub Actions 作ってみた on x" href="https://x.com/intent/tweet/?text=%f0%9f%93%94%20Zenn%20%e3%81%ae%e8%a8%98%e4%ba%8b%e3%82%92%20DEV%20%e3%81%ab%e8%87%aa%e5%8b%95%e7%9a%84%e3%81%ab%e5%90%8c%e6%9c%9f%e3%81%95%e3%81%9b%e3%82%8b%20GitHub%20Actions%20%e4%bd%9c%e3%81%a3%e3%81%a6%e3%81%bf%e3%81%9f&amp;url=https%3a%2f%2fnikaera.com%2farchives%2fsync-zenn-with-dev-action%2f&amp;hashtags=typescript%2cgithubactions%2cforem"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 📔 Zenn の記事を DEV に自動的に同期させる GitHub Actions 作ってみた on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fnikaera.com%2farchives%2fsync-zenn-with-dev-action%2f&amp;title=%f0%9f%93%94%20Zenn%20%e3%81%ae%e8%a8%98%e4%ba%8b%e3%82%92%20DEV%20%e3%81%ab%e8%87%aa%e5%8b%95%e7%9a%84%e3%81%ab%e5%90%8c%e6%9c%9f%e3%81%95%e3%81%9b%e3%82%8b%20GitHub%20Actions%20%e4%bd%9c%e3%81%a3%e3%81%a6%e3%81%bf%e3%81%9f&amp;summary=%f0%9f%93%94%20Zenn%20%e3%81%ae%e8%a8%98%e4%ba%8b%e3%82%92%20DEV%20%e3%81%ab%e8%87%aa%e5%8b%95%e7%9a%84%e3%81%ab%e5%90%8c%e6%9c%9f%e3%81%95%e3%81%9b%e3%82%8b%20GitHub%20Actions%20%e4%bd%9c%e3%81%a3%e3%81%a6%e3%81%bf%e3%81%9f&amp;source=https%3a%2f%2fnikaera.com%2farchives%2fsync-zenn-with-dev-action%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 📔 Zenn の記事を DEV に自動的に同期させる GitHub Actions 作ってみた on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fnikaera.com%2farchives%2fsync-zenn-with-dev-action%2f&title=%f0%9f%93%94%20Zenn%20%e3%81%ae%e8%a8%98%e4%ba%8b%e3%82%92%20DEV%20%e3%81%ab%e8%87%aa%e5%8b%95%e7%9a%84%e3%81%ab%e5%90%8c%e6%9c%9f%e3%81%95%e3%81%9b%e3%82%8b%20GitHub%20Actions%20%e4%bd%9c%e3%81%a3%e3%81%a6%e3%81%bf%e3%81%9f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 📔 Zenn の記事を DEV に自動的に同期させる GitHub Actions 作ってみた on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fnikaera.com%2farchives%2fsync-zenn-with-dev-action%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 📔 Zenn の記事を DEV に自動的に同期させる GitHub Actions 作ってみた on whatsapp" href="https://api.whatsapp.com/send?text=%f0%9f%93%94%20Zenn%20%e3%81%ae%e8%a8%98%e4%ba%8b%e3%82%92%20DEV%20%e3%81%ab%e8%87%aa%e5%8b%95%e7%9a%84%e3%81%ab%e5%90%8c%e6%9c%9f%e3%81%95%e3%81%9b%e3%82%8b%20GitHub%20Actions%20%e4%bd%9c%e3%81%a3%e3%81%a6%e3%81%bf%e3%81%9f%20-%20https%3a%2f%2fnikaera.com%2farchives%2fsync-zenn-with-dev-action%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 📔 Zenn の記事を DEV に自動的に同期させる GitHub Actions 作ってみた on telegram" href="https://telegram.me/share/url?text=%f0%9f%93%94%20Zenn%20%e3%81%ae%e8%a8%98%e4%ba%8b%e3%82%92%20DEV%20%e3%81%ab%e8%87%aa%e5%8b%95%e7%9a%84%e3%81%ab%e5%90%8c%e6%9c%9f%e3%81%95%e3%81%9b%e3%82%8b%20GitHub%20Actions%20%e4%bd%9c%e3%81%a3%e3%81%a6%e3%81%bf%e3%81%9f&amp;url=https%3a%2f%2fnikaera.com%2farchives%2fsync-zenn-with-dev-action%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 📔 Zenn の記事を DEV に自動的に同期させる GitHub Actions 作ってみた on ycombinator" href="https://news.ycombinator.com/submitlink?t=%f0%9f%93%94%20Zenn%20%e3%81%ae%e8%a8%98%e4%ba%8b%e3%82%92%20DEV%20%e3%81%ab%e8%87%aa%e5%8b%95%e7%9a%84%e3%81%ab%e5%90%8c%e6%9c%9f%e3%81%95%e3%81%9b%e3%82%8b%20GitHub%20Actions%20%e4%bd%9c%e3%81%a3%e3%81%a6%e3%81%bf%e3%81%9f&u=https%3a%2f%2fnikaera.com%2farchives%2fsync-zenn-with-dev-action%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://nikaera.com/>Nikaeraintokyo.</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>